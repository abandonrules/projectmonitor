<!DOCTYPE html>
<html>
<head>
<title>Project Monitor</title>

<!-- Check the CfA Style Guide at https://style.codeforamerica.org/ -->
<link rel="stylesheet" href="https://style.codeforamerica.org/style/css/main.css">
<link rel="stylesheet" href="https://style.codeforamerica.org/style/css/layout.css" media="all and (min-width: 40em)">

<style lang="text/css">
p.add-note { margin: 20px 0 0 30px }
p.add-note, p.add-note * { color: white }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
</head>
<body class='dashboard'>

  <div class="layout-breve">

  <h1>The Civic Tech Movements Project Monitor</h1>

  <ul id="projects">
  </ul>

</div>
</body>

<script>
$( document ).ready(function() {

  $.getJSON("https://www.codeforamerica.org/api/projects", function(response){

    function getProjects(){
      
    }

    $.each(response.objects, function(i, project){

      if (project.code_url) {

        if (project.code_url.indexOf('github.com') > -1) {

            repo = project.code_url.replace("https://github.com/","");

            travis_url = 'https://api.travis-ci.org/repositories/' + repo + '/builds'

            $.getJSON(travis_url, function(response){

              if (response[0]) {

                if (response[0].result == 0){
                  project.state_class = "success"
                } else {
                  project.state_class = "failure error"
                }

                var html = `<li class="project `+project.state_class+`">
                    <h2><span class="centered-words">`+project.name+`</span></h2>
                    <p class="builds">
                        <span class="icon">&#9874;</span> Built <span id="time-since-last-build">`+moment(new Date(project.last_updated)).fromNow()+`</span> ago
                    </p>
                </li>`;

                $("#projects").append(html);

              }

            });

          }

        }

    });

  });

});

</script>

</html>