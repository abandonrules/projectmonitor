<!DOCTYPE html>
<html>
<head>
<title>Project Monitor</title>

<link href="/static/styles.css" media="screen" rel="stylesheet" />

<!-- Check the CfA Style Guide at https://style.codeforamerica.org/ -->
    <link rel="stylesheet" href="https://style.codeforamerica.org/style/css/main.css">
    <link rel="stylesheet" href="https://style.codeforamerica.org/style/css/layout.css" media="all and (min-width: 40em)">
<link rel="shortcut icon"
    href="{{ url_for('static', filename='img/favicon.ico') }}">
<meta content='300' http-equiv='refresh'>
<style lang="text/css">
p.add-note { margin: 20px 0 0 30px }
p.add-note, p.add-note * { color: white }
</style>
</head>
<body class='dashboard'>

  <div class="layout-breve">

  {% if org_name %}
  <h1>{{org_name}}'s Project Monitor</h1>
  {% else %}
  <h1>The Civic Tech Movements Project Monitor</h1>
  {% endif %}

<ul class="projects">
</ul>

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>

<script>
$( document ).ready(function() {

  var projects = {{projects | tojson}};

  $.each(projects, function(i, project){

      console.log(project.travis_url);
      $.getJSON(project.travis_url, function(response){

        if (response[0]) {

          if (response[0].result == 0){
            project.state_class = "success"
          } else {
            project.state_class = "failure error"
          }

          var html = `<li class="project `+project.state_class+`">
              <h2><span class="centered-words">`+project.name+`</span></h2>
              <p class="builds">
                  <span class="icon">&#9874;</span> Built <span id="time-since-last-build">`+moment(new Date(project.last_updated)).fromNow()+`</span> ago
              </p>
          </li>`;

          $(".projects").append(html);

        }

      });

  });

});

</script>


<script type="text/javascript">
  $( document ).ready(function() {

  });
</script>
</div>
</body>
</html>
